<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Consulta Zarpes Acciona</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #fff;
      color: #000;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 20px;
    }

    h1 {
      font-size: 20px;
      color: #c80000;
      margin: 5px 0 20px 0;
      text-align: center;
    }

    .input-group {
      display: flex;
      align-items: center;
      border: 1px solid #ccc;
      border-radius: 8px;
      overflow: hidden;
      width: 300px;
      background-color: #fff;
      padding-left: 6px;
    }

    .input-group img {
      width: 28px;
      height: 28px;
      margin-right: 5px;
    }

    .input-group input {
      border: none;
      outline: none;
      padding: 10px;
      font-size: 13px;
      flex: 1;
    }

    .input-group input::placeholder {
      font-size: 11px;
      color: #888;
    }

    button {
      margin-top: 10px;
      padding: 8px 16px;
      background-color: #c80000;
      color: #fff;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 14px;
    }

    button:hover {
      background-color: #a00000;
    }

    .resultado {
      margin-top: 20px;
      border: 1px solid #ddd;
      padding: 10px;
      border-radius: 8px;
      background-color: #f9f9f9;
      width: 300px;
      font-size: 14px;
    }

    .leyenda {
      font-size: 12px;
      color: #555;
      margin-top: 12px;
      text-align: center;
      max-width: 320px;
    }

    .logo-top {
      position: relative;
      display: flex;
      justify-content: center;
      align-items: center;
      margin-bottom: 10px;
    }

    .logo-top img {
      height: 40px;
    }

    .loader {
      border: 3px solid #f3f3f3;
      border-top: 3px solid #c80000;
      border-radius: 50%;
      width: 18px;
      height: 18px;
      animation: spin 1s linear infinite;
      margin: 10px auto;
      display: none;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
  </style>
</head>
<body>

  <div class="logo-top">
    <img src="https://raw.githubusercontent.com/acciona-airport/Zarpes-acciona-aero/main/LogoAcciona2.png" alt="Logo Acciona">
  </div>

  <h1>Consulta Zarpes Acciona</h1>

  <div class="input-group">
    <img src="https://raw.githubusercontent.com/acciona-airport/Zarpes-acciona-aero/main/LogoPersonal.svg" alt="Icono RUT" />
    <input type="text" id="rut" placeholder="Ingresa tu RUT sin puntos y con guion Ej: 12345678-9" />
  </div>

  <button onclick="buscar()">Buscar</button>

  <div class="loader" id="loader"></div>

  <div class="leyenda">
    Esta herramienta está diseñada exclusivamente para revisar si está considerado en el movil al término de su turno. En caso de que se haya prolongado, puede existir una diferencia de horario. Si tiene dudas, llame a la oficina de Realtime o a su Supervisor.
  </div>

  <div id="resultado" class="resultado" style="display:none;"></div>

  <script>
    async function buscar() {
      const rut = document.getElementById("rut").value.trim();
      const resultado = document.getElementById("resultado");
      const loader = document.getElementById("loader");

      resultado.style.display = "none";
      loader.style.display = "block";

      if (!rut) {
        loader.style.display = "none";
        resultado.style.display = "block";
        resultado.innerHTML = "⚠️ Ingresa un RUT válido.";
        return;
      }

      try {
        const response = await fetch(
          "https://script.google.com/macros/s/AKfycbzefe-5qo2uc2jjy5vEGcy6RBPp9Xw4UL-XAa7UPNPAb6eBjsqBjs8_anw3oTck_92BGA/exec"
        );
        const data = await response.json();

        const encontrado = data.find(item => {
          if (typeof item.RUT === "string") {
            return item.RUT.replace(/\./g, "").toLowerCase() === rut.toLowerCase();
          } else if (typeof item.RUT === "number") {
            return String(item.RUT).includes(rut.replace("-", ""));
          }
          return false;
        });

        loader.style.display = "none";

        if (encontrado) {
          resultado.style.display = "block";
          resultado.innerHTML = `
            <strong>RUT:</strong> ${encontrado.RUT}<br>
            <strong>Nombre:</strong> ${encontrado.NOMBRE}<br>
            <strong>Sección:</strong> ${encontrado["SECCIÓN"]}<br>
            <strong>Comuna:</strong> ${encontrado.COMUNA}<br>
            <strong>Hora Estimada:</strong> ${formatearHora(encontrado["HORA ESTIMADA TERMINO TURNO"])}
          `;
        } else {
          resultado.style.display = "block";
          resultado.innerHTML = "❌ No se encontró ningún trabajador con ese RUT.";
        }
      } catch (error) {
        loader.style.display = "none";
        resultado.style.display = "block";
        resultado.innerHTML = "❌ Error al consultar los datos.";
        console.error(error);
      }
    }

    function formatearHora(horaStr) {
      try {
        const date = new Date(horaStr);
        return date.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit', hour12: false });
      } catch {
        return horaStr;
      }
    }
  </script>

</body>
</html>
