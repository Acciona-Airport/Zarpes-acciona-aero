<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Consulta Zarpes Acciona</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #fff;
      color: #000;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 20px;
      margin: 0;
    }

    .logo-container {
      align-self: flex-start;
      margin-left: calc(50% - 165px);
    }

    .logo {
      height: 60px;
      margin-bottom: 10px;
    }

    h1 {
      font-size: 16px;
      color: #c80000;
      margin: 5px 0 20px 0;
      text-align: center;
    }

    .input-group {
      display: flex;
      align-items: center;
      border: 1px solid #ccc;
      border-radius: 8px;
      overflow: hidden;
      width: 300px;
      background-color: #fff;
    }

    .input-group img {
      width: 30px;
      height: 30px;
      padding: 4px;
      background-color: #fff;
    }

    .input-group input {
      border: none;
      outline: none;
      padding: 10px;
      font-size: 14px;
      flex: 1;
    }

    .input-group input::placeholder {
      font-size: 11px;
      color: #888;
    }

    button {
      margin-top: 10px;
      padding: 8px 16px;
      background-color: #c80000;
      color: #fff;
      border: none;
      border-radius: 6px;
      cursor: pointer;
    }

    button:hover {
      background-color: #a00000;
    }

    .resultado {
      margin-top: 20px;
      border: 1px solid #ddd;
      padding: 10px;
      border-radius: 8px;
      background-color: #f9f9f9;
      width: 300px;
    }

    .leyenda {
      font-size: 12px;
      color: #555;
      margin-top: 12px;
      text-align: center;
      max-width: 320px;
    }

    .cargando {
      margin-top: 15px;
      font-size: 14px;
      color: #333;
    }

    .spinner {
      border: 3px solid #f3f3f3;
      border-top: 3px solid #c80000;
      border-radius: 50%;
      width: 16px;
      height: 16px;
      animation: spin 1s linear infinite;
      display: inline-block;
      margin-right: 6px;
      vertical-align: middle;
    }

    .spinner-check {
      border: 3px solid #f3f3f3;
      border-top: 3px solid #007700;
      border-radius: 50%;
      width: 14px;
      height: 14px;
      animation: spin 1s linear infinite;
      display: inline-block;
      margin-right: 6px;
      vertical-align: middle;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
  </style>
</head>
<body>

  <div class="logo-container">
    <img class="logo" src="https://raw.githubusercontent.com/acciona-airport/Zarpes-acciona-aero/main/LogoAcciona2.png" alt="Logo Acciona" />
  </div>

  <h1>Consulta Zarpes Acciona</h1>

  <div class="input-group">
    <img src="https://raw.githubusercontent.com/acciona-airport/Zarpes-acciona-aero/main/LogoPersonal.svg" alt="Icono RUT" />
    <input type="text" id="rut" placeholder="Ingrese su RUT sin puntos y sin guion." />
  </div>

  <button id="btnBuscar" onclick="buscar()" disabled>Buscar</button>

  <div id="verificacion" style="margin-top: 10px;">
    <button id="btnVerificar" onclick="verificar()" style="padding: 6px 12px; background-color: #f0f0f0; border: 1px solid #aaa; border-radius: 4px; cursor: pointer;">
      ✅ No soy un robot
    </button>
    <div id="msgVerificado" style="color: green; font-size: 12px; margin-top: 6px;"></div>
  </div>

  <div id="cargando" class="cargando" style="display:none;">
    <span class="spinner"></span>Cargando información...
  </div>

  <div class="leyenda">
    Esta herramienta está diseñada exclusivamente para revisar si está considerado el movil al término de su turno. En caso de que se haya prolongado, puede existir una diferencia de horario, si tiene dudas, llame a la oficina de "Realtime" o a su "Supervisor".
  </div>

  <div id="resultado" class="resultado" style="display:none;"></div>

  <script>
    function verificar() {
      const btn = document.getElementById("btnVerificar");
      const msg = document.getElementById("msgVerificado");
      const btnBuscar = document.getElementById("btnBuscar");

      btn.disabled = true;
      btn.innerHTML = '<span class="spinner-check"></span> Verificando...';

      setTimeout(() => {
        btn.style.display = "none";
        btnBuscar.disabled = false;
        msg.innerText = "✔️ Verificado. Puedes buscar ahora.";
      }, 1000);
    }

    async function buscar() {
      const rut = document.getElementById("rut").value.trim();
      const resultado = document.getElementById("resultado");
      const cargando = document.getElementById("cargando");

      resultado.style.display = "none";
      cargando.style.display = "block";

      if (!rut) {
        cargando.style.display = "none";
        resultado.style.display = "block";
        resultado.innerHTML = "⚠️ Ingresa un RUT válido.";
        return;
      }

      try {
        const response = await fetch(
          "https://script.google.com/macros/s/AKfycbzTOEIbHqb5yVEYyLQNRRwRLQ6D1PVTuU3Ii_qXkbFNod6I4ds3WHPA2NmXAgYao1N2Zw/exec"
        );
        const data = await response.json();

        const encontrado = data.find(item => {
          if (typeof item.RUT === "string") {
            return item.RUT.replace(/\./g, "").toLowerCase() === rut.toLowerCase();
          } else if (typeof item.RUT === "number") {
            return String(item.RUT).includes(rut.replace("-", ""));
          }
          return false;
        });

        cargando.style.display = "none";
        resultado.style.display = "block";

        if (encontrado) {
          resultado.innerHTML = `
            <strong>RUT:</strong> ${encontrado.RUT}<br>
            <strong>Nombre:</strong> ${encontrado.NOMBRE}<br>
            <strong>Sección:</strong> ${encontrado["SECCIÓN"]}<br>
            <strong>Comuna:</strong> ${encontrado.COMUNA}<br>
            <strong>Hora Estimada:</strong> ${formatearHora(encontrado["HORA ESTIMADA TERMINO TURNO"])}
          `;
        } else {
          resultado.innerHTML = "❌ No se encontró ningún trabajador con ese RUT.";
        }
      } catch (error) {
        cargando.style.display = "none";
        resultado.style.display = "block";
        resultado.innerHTML = "❌ Error al consultar los datos.";
        console.error(error);
      }
    }

    function formatearHora(horaStr) {
      try {
        const date = new Date(horaStr);
        return date.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit', hour12: false });
      } catch {
        return horaStr;
      }
    }
  </script>

</body>
</html>
